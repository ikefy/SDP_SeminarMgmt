<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>CHITCHAT | Welcome</title>
        <link rel="stylesheet" href="./assets/css/seminar_style.css">
        <link rel="stylesheet" href="./assets/css/coreui.min.css">
        <link rel="stylesheet" href="./assets/css/coreui-icons.min.css">
    </head>
    <body>
        <script src="./assets/js/jquery-3.3.1.min.js"></script>
        <header>
            <div class="container">
                <div id="branding">
                    <h1 class="hightlight">CHITCHAT</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li class="current"><a href="seminar_list.html">Seminar</a></li>
                        <li><a href="create_seminar.html">Create Seminar</a></li>
                        <li><a href="index.html">Attendee</a></li>
                    </ul>
                </nav>
            </div>
        </header>
        <section id="middlepart">
            <div class="container">
                <aside id="sidenav">
                    <img src="./assets/img/uts.png">
                    <nav>
                        <ul>
                            <li><a href="index.html">My Seminars</a></li>
                            <li><a href="my_profile.html">My Profile</a></li>
                        </ul>
                    </nav>
                </aside>
                <div class="app-body">
                    <main class="main">
                        <br />
                        <button class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="searchsem1()">All Seminars</button>
                        <button class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="searchsem2('sept')">September</button>
                        <button class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="searchsem2('oct')">October</button>
                        <br />
                        <br />
                        <table id="semtbl" class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Seminar ID</th>
                                    <th scope="col">Seminar Name</th>
                                    <th scope="col">Venue</th>
                                    <th scope="col">Date</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <br />
                        <br />
                        <form class="form-inline">
                            <input id="SeminarID" class="form-control mr-sm-2" type="text" value="" placeholder="Enter SeminarID" aria-label="Search">
                            <button class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="getAttendees(SeminarID.value);">Show Attendees</button>
                            <button class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="jcquery(SeminarID.value);">Seminar Details</button>
                        </form>
                        <br />
                        <table id="attendeetblheader" class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Seminar Name: </th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                        </table>
                        <table id="attendeetbl" class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Attendee ID</th>
                                    <th scope="col">Attendee Name</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Contact Number</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <br />
                        <br />
                        <br />
                        <br />
                        <br />
                        <br />
                    </main>
                </div>
            </div>
        </section>
        <footer>
            <p>SDP</p>
        </footer>
        <script type='text/javascript'>
            function searchsem1() {
                console.log("start searchsem()");
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "https://sdp-seminarmgmt.azurewebsites.net/api/seminar/",
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache",
                        "postman-token": "3f79c459-fd65-db7e-5d1a-f66cc2ff2cbf"
                    }
                }
                $.ajax(settings).done(function (response) {
                    console.log(response);
                    var seminars = response;
                    var seminar_parse = JSON.parse(seminars);
                    setsemtblvalues(seminar_parse.length, seminar_parse);
                });
            }

            function searchsem2(month) {
                console.log("start searchsem()");
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "https://sdp-seminarmgmt.azurewebsites.net/api/seminar/daterange/" + month,
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache",
                        "postman-token": "3f79c459-fd65-db7e-5d1a-f66cc2ff2cbf"
                    }
                }
                $.ajax(settings).done(function (response) {
                    console.log(response);
                    var seminars = response;
                    var seminar_parse = JSON.parse(seminars);
                    var seminar_length = seminar_parse.length;
                    setsemtblvalues(seminar_parse.length, seminar_parse);
                });
            }

            function setsemtblvalues(x, seminars) {
                console.log(seminars);
                console.log(seminars[0]);
                console.log(seminars[0].RoomID);
                console.log(seminars.length);
                cleartbl();
                createtbl(x);
                setsemtblCells(seminars);
            }

            function cleartbl() {
                var table = document.getElementById("semtbl");
                var rows = document.getElementById("semtbl").getElementsByTagName("tr").length;
                console.log(rows);
                for (var i = 1; i < rows; i++) {
                    table.deleteRow(1);
                }
            }

            function createtbl(x) {
                console.log("cleartbl");
                for (var i = 0; i < x; i++) {
                    //var x = document.getElementById("semtbl").rows[i + 1].cells;
                    //x[0].innerHTML = ".";
                    //x[1].innerHTML = ".";
                    //x[2].innerHTML = ".";
                    //x[3].innerHTML = ".";
                    var table = document.getElementById("semtbl");
                    var row = table.insertRow(i+1);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell1 = row.insertCell(2);
                    var cell2 = row.insertCell(3);
                }
            }

            function setsemtblCells(seminars) {
                console.log("settbl");
                for (var i = 0; i < seminars.length; i++) {
                    var x = document.getElementById("semtbl").rows[i + 1].cells;
                    x[0].innerHTML = seminars[i].SeminarID;
                    //var y = document.getElementById(i);
                    //y.value = seminar_parse[i].SeminarID;
                    x[1].innerHTML = seminars[i].SeminarTitle;
                    x[2].innerHTML = seminars[i].RoomNumber;
                    x[3].innerHTML = seminars[i].SeminarDate;
                }
            }
        </script>
        <script type='text/javascript'>
            function getAttendees(SeminarID) {
                console.log(SeminarID);
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "https://sdp-seminarmgmt.azurewebsites.net/api/seminar/" + SeminarID + "/attendees",
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache",
                        "postman-token": "481f3c97-846c-8bc1-e812-ba8d0bd6e7e5"
                    }
                }

                $.ajax(settings).done(function (response) {
                    console.log(response);
                    var attendees = response;
                    var attendees_parse = JSON.parse(attendees);
                    setattendeetblvalues(attendees_parse.length, attendees_parse);
                });
            }

            function setattendeetblvalues(y, attendees) {
                console.log(attendees);
                console.log(attendees[0]);
                console.log(attendees[0].AttendeeFirstName);
                console.log(attendees.length);
                clearattendeetbl();
                createattendeetbl(y);
                setattendeetblCells(attendees);
            }

            function clearattendeetbl() {
                var table = document.getElementById("attendeetbl");
                var rows = document.getElementById("attendeetbl").getElementsByTagName("tr").length;
                console.log(rows);
                for (var i = 1; i < rows; i++) {
                    table.deleteRow(1);
                }
            }

            function createattendeetbl(y) {
                console.log("clearattendeetbl");
                for (var i = 0; i < y; i++) {
                    var table = document.getElementById("attendeetbl");
                    var row = table.insertRow(i + 1);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell1 = row.insertCell(2);
                    var cell2 = row.insertCell(3);
                }
            }

            function setattendeetblCells(attendees) {
                console.log("setattendeetbl");
                for (var i = 0; i < attendees.length; i++) {
                    var y = document.getElementById("attendeetbl").rows[i + 1].cells;
                    y[0].innerHTML = attendees[i].AttendeeID;
                    //var y = document.getElementById(i);
                    //y.value = seminar_parse[i].SeminarID;
                    y[1].innerHTML = attendees[i].AttendeeFirstName + " " + attendees[i].AttendeeLastName;
                    y[2].innerHTML = attendees[i].AttendeeEmailAddress;
                    y[3].innerHTML = attendees[i].AttendeePhoneNumber;
                }
                var x = document.getElementById("attendeetblheader").rows[0].cells;
                //x[0].innerHTML = "Seminar Name: " + attendees[0].
            }
        </script>
    </body>
</html>